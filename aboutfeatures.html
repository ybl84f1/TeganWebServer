<!DOCTYPE html>
<html>
<head>
  <title>aboutfeatures.html</title>
</head>
<body bgcolor="#E6E6FA"><br>
      <font size=6>Tegan Web Server - Features</font><br><br>
      <font size=3>
<p>
<u><font size=5>Page Methods and Substitute Tags</font></u><br><br>
One challenge with a basic web server that simply streams back static HTML pages is the inability to report 
back dynamic data such as the reading of an A/D pin. Even if the A/D reading could be reported back it is 
often useless since most of the time it's an input to a computation, such as calculating the temperature 
from a thermistor reading.
<br><br>
TeganWS has two features that enable server-generated data to be displayed as part of an HTML 
page: <b>Page Methods</b> and<b> Substitution Tags</b>. Page Methods allow the linking of a method (aka 
procedure/function) to a specific HTML page so that whenever the HTML page is requested by a client the 
specific code on the Edison is executed. So for example, a web page that presents the temperature might 
be linked to a method that reads a thermistor device on the analog input pin and calculates the temperature 
from that reading. However that reading still needs to be inserted into an existing HTML web page, which leads
us to <b>Substitution Tags</b>.
<br>
<br>
<b>Substitution Tags</b> are a special type of HTML tag that are used in the HTML file to insert dynamic 
data into a static web page. This works because the TeganWS file streamer scans the web page for these Tags as it's
streaming the web page back to the client. When it finds one it substitutes the supplied data in place of the tag.
<br>
<br>
So let's see how these two would work together with a web page that returns the temperature. First, we write
a method called "<b>calc_temp()</b>" which reads a thermistor attached to an analog input and calculates the 
temperature.
<br>
<br>
Next, by adding a table entry and a small amount of code to the TeganWS software we link the name of the HTML
web page (<b>"temperature.html"</b>) to the function "<b>calc_temp()</b>" so that whenever the page is
requested the function is automatically run.
<br>
<br>
Next we create "<b>temperature.html</b>" that includes a Substitution Tag. A snippet of the page's HTML might 
look like this:
<br>
<br><font size=3><.b><.u>HOME TEMPERATURE<./u><./b>
<br><.br>The temperature in the living room is: <.%SL0> Celsius<.br></font>
<br>
<br>
<center>(<b>NOTE</b>: Periods "." were added after each "<" such that the tags would 
not be rendered on this page)</center>
<br><br>
So let's tie it all together. A client browser requests the page "<b>temperature.html</b>" from the TeganWS 
server. Since this is linked to the method "<b>calc_temp()</b>" that function runs and calculates the 
temperature. The temperature reading is passed to the TWS file streamer which opens the file 
"<b>temperature.html</b>" on the SD Card and scans the file for <b>Substitution Tags</b> as it streams 
the file to the client. When it finds the <b>Substitution Tag</b> it substitutes the temperature reading
in place of the tag. The code snippet above is rendered as:
<br><br>
<font size=3><b><u>HOME TEMPERATURE</u></b>
<br>The temperature in the living room is: 23 Celsius</font>
<br><br><br>
If you only need the actual value of an Analog (0-1023) or Digital (0/1) pin you can easily insert
them into an HTML page without any changes to the TeganWS software at all. TeganWS supports two 
types of Substitution Tags.
<br><br>
The two types of <b>Substitution Tags</b> are:
<br><br>
<ul>
<li><b>PIN TAGS</b>: A PIN Substitute Tag replaces the tag with the reading from an Analog (0-1023) or Digital (0/1) 
input pin. This tag provides a simple and easy way to incorporate pin readings directly into an HTML page. A 
Substitute PIN Tag has the form <b>"<.%SPAIP#>"</b> or <b>"<.%SPDIP#>"</b> which represents:
</li>
<br><b>"<.%SP"</b> - Beginning of the HTML Substitute Pin Tag.
<br><b>"AI"</b> or <b>"DI"</b> - Specifies Analog or Digital Input
<br><b>"P#>"</b> - Specifies Pin Number where "#" is 0, 1, 2, ...
<br><br> For example the Substitute Tag <b>"<.%SPAIP02>"</b> in an HTML file would be replaced by the value of 
Analog Pin #2, a number between 0 - 1023. Note in this case no Page Method (and changes to the TWS software) is 
required; simply place the tag anywhere in the HTML web page.
<br><br>
<li><b>LIST TAGS</b>: A LIST Substitute Tag replaces the tag with one of a list of null terminated ASCII strings
generated by a Page Method.This is useful for inserting customized data into the HTML file as in the above room 
temperature example where the number being substituted was not a simple pin reading but the result of a temperature 
calculation. In this case the Page Method associated with the HTML page calculated the temperature and converted 
the result to an ASCII string. A Substitute LIST Tag has the form <b>"<.%SL#>"</b> which represents:
</li>
<br><b>"<.%SL"</b> - Beginning of the HTML Substitute List Tag
<br><b>"#>"</b> - Specifies the index (0, 1, 2, ...) into a list of null-terminated ASCII strings
<br><br>
For example the Substitute Tag <b>"<.%SL03>"</b> would be replaced by the 4th null-terminated ASCII string passed
to the file streamer from the Page Method callee.
<br><br>
</ul>
<center>(<b>NOTE</b>: Periods "." were added after each "<" such that the tags would 
not be rendered on this page)</center>
<br><br>
<br><br>
The Client/Server Page Method and Substitution Tag flow looks like this:<br>
<br><br>
<center>User creates HTML page with Substitution Tag(s)</center>
<center>|</center>
<center>User optionally creates Page Method (for List Tag(s))</center>
<center>|</center>
<center>Client request for HTML page</center>
<center>|</center>
<center>TeganWS calls associated Page Method if one exists otherwise calls TeganWS File Streamer</center>
<center>|</center>
<center>If Page Method available, generate substitution data as ASCII strings</center>
<center>|</center>
<center>If Page Method, call TeganWS File Streamer passing generated data</center>
<center>|</center>
<center>TeganWS File Streamer sends file to client while scanning for Substitution Tags</center>
<center>|</center>
<center>TeganWS File Streamer replaces <b>LIST</b> Substitution Tags with Page Method data</center>
<center><b>AND/OR</b></center>
<center>replaces <b>PIN</b> Substitution Tags with analog/digital pin readings.</center>
<center></center>
<br><br><br>
Look at the supplied HTML file "environmental.html" to see some actual Substitution Codes being used.
<br><br><br>

<u><font size=5>Analog and Digital I/O Control</font></u><br><br>
To read Analog and Digital input signals, or to write to digital pins an HTML page ("iocontrol.html") 
as well as a method ("iocontrolhtml()") are included with TeganWS and are accessible on the Main Menu 
under <b>"I/O Control"</b>. By default this page will display several Analog Input channels, several 
Digital Input channels, and allows setting of several Digital Output channels to HIGH, LOW or RESET. Note 
that <u><b>TeganWS makes no attempt</b></u> to determine if the input or output pins are valid for the 
particular Arduino or Edison environment.
<br><br><br>
<u><font size=5>Log Files</font></u><br><br>
Two log files - "httplog.txt" and "httperror.txt" are kept automatically on the SD card file system. These 
are single line entries that are time-stamped so the operator can corrolate any errors with HTTP 
requests. The <b>"syslogfile.html"</b> HTML web page is not a file on the SD Card but rather is generated 
in the TeganWS code and displays the tail of each log file. Both files are limited to a size of 2 MB each 
before they are deleted and started again. An example of the "httplog.txt" would be:
<br>
<br><b>
@737 min; GET /iocontrol.html?DO13=LOW HTTP/1.1<br>
@737 min; GET / HTTP/1.1<br>
@738 min; GET /about.html HTTP/1.1
</b>
<br><br><br>
<u><font size=5>HTML File Upload</font></u><br><br>
HTML files can be uploaded from a client to the Edison computer which are then stored on the SD Card storage 
device. These files must have a ".html" extension. The web page "fileupload.html" uses a "POST" HTTP 
command which safely uploads the file with the same name as the source file. This allows the user to create
and edit HTML files on their client and transfer them to the TeganWS server without a utility such as SSH.
<br><br><br><br>
<table border="1" style="width:100%">
<tr>
    <td><center><a href="/ ">HOME</a></center></td>
    <td><center><a href="/about.html">ABOUT</a></center></td> 
    <td><center><a href="/aboutfeatures.html">FEATURES</a></center></td>
    <td><center><a href="/tutorials.html">TUTORIALS</a></center></td>
</tr></table></body>
<br><br>
</html>